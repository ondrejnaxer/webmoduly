
<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Správa menu (UI bez back-endu)</title>
  <style>
    :root{
      --bg:#f0f2f5;
      --panel:#ffffff;
      --border:#dcdcde;
      --muted:#646970;
      --text:#1d2327;
      --blue:#2271b1;
      --blue2:#135e96;
      --danger:#b32d2e;
      --shadow:0 1px 1px rgba(0,0,0,.04);
      --radius:6px;
      --indent:30px;
      --rowpad:12px;
      --font: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--font);
      color:var(--text);
      background:var(--bg);
    }

    /* Top bar */
    .topbar{
      position:sticky; top:0; z-index:10;
      background:var(--panel);
      border-bottom:1px solid var(--border);
      box-shadow:var(--shadow);
    }
    .topbar .inner{
      max-width:1100px;
      margin:0 auto;
      padding:12px 16px;
      display:flex;
      gap:12px;
      align-items:center;
      flex-wrap:wrap;
    }
    .topbar label{
      color:var(--muted);
      font-size:12px;
      display:block;
      margin-bottom:4px;
    }
    .field{
      display:flex;
      flex-direction:column;
      min-width:240px;
    }
    select, input[type="text"], input[type="url"]{
      width:100%;
      padding:8px 10px;
      border:1px solid var(--border);
      border-radius:var(--radius);
      outline:none;
      background:#fff;
      font-size:14px;
    }
    select:focus, input:focus{
      border-color:rgba(34,113,177,.6);
      box-shadow:0 0 0 3px rgba(34,113,177,.15);
    }
    .btn{
      border:1px solid var(--border);
      background:#fff;
      padding:8px 12px;
      border-radius:var(--radius);
      cursor:pointer;
      font-weight:600;
      font-size:14px;
      color:var(--text);
    }
    .btn.primary{
      background:var(--blue);
      border-color:var(--blue);
      color:#fff;
    }
    .btn.primary:hover{ background:var(--blue2); border-color:var(--blue2); }
    .btn:hover{ border-color:#c3c4c7; }
    .btn:active{ transform:translateY(1px); }
    .btn.danger{
      color:#fff;
      background:var(--danger);
      border-color:var(--danger);
    }
    .spacer{ flex:1; }

    /* Layout */
    .wrap{
      max-width:1100px;
      margin:18px auto 48px;
      padding:0 16px;
    }
    .notice{
      color:var(--muted);
      font-size:13px;
      margin:14px 2px;
    }

    /* Menu items */
    .list{
      background:transparent;
    }
    .menu-item{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      margin:10px 0;
      overflow:hidden;
    }
    .menu-item.dragging{
      opacity:.6;
      outline:2px dashed rgba(34,113,177,.6);
      outline-offset:2px;
    }
    .menu-item .head{
      display:flex;
      align-items:center;
      gap:10px;
      padding:var(--rowpad);
      cursor:grab;
      user-select:none;
    }
    .menu-item .head:active{ cursor:grabbing; }
    .title{
      font-weight:700;
      flex:1;
      display:flex;
      align-items:center;
      gap:8px;
      min-width:0;
    }
    .title .badge{
      font-size:12px;
      color:var(--muted);
      font-weight:600;
      border:1px solid var(--border);
      padding:2px 8px;
      border-radius:999px;
      white-space:nowrap;
    }
    .title .txt{
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .toggle{
      width:34px; height:34px;
      border:1px solid var(--border);
      border-radius:8px;
      display:grid;
      place-items:center;
      background:#fff;
      cursor:pointer;
    }
    .toggle:hover{ border-color:#c3c4c7; }
    .toggle svg{
      width:16px; height:16px;
      transition:transform .15s ease;
    }
    .menu-item.open .toggle svg{ transform:rotate(180deg); }

    .details{
      display:none;
      border-top:1px solid var(--border);
      padding:14px 14px 10px;
      background:#fbfbfc;
    }
    .menu-item.open .details{ display:block; }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }
    .grid .full{ grid-column:1 / -1; }
    .actions{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
    }
    .actions .links{
      font-size:13px;
      color:var(--muted);
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      align-items:center;
    }
    .linkbtn{
      border:none;
      background:transparent;
      color:var(--blue);
      cursor:pointer;
      padding:0;
      font-size:13px;
      font-weight:600;
    }
    .linkbtn:hover{ color:var(--blue2); text-decoration:underline; }
    .linkbtn.danger{ color:var(--danger); }
    .meta{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
    }

    /* Drop indicator */
    .drop-hint{
      height:0;
      border-top:2px solid rgba(34,113,177,.65);
      margin:0 0 0 0;
      display:none;
    }
    .drop-hint.show{ display:block; }

    /* Indentation */
    .indent{
      padding-left: calc(var(--rowpad) + var(--lvl) * var(--indent));
    }
    .indent.details-pad{
      padding-left: calc(14px + var(--lvl) * var(--indent));
    }

    /* Footer export */
    .footer{
      margin-top:18px;
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:14px;
    }
    textarea{
      width:100%;
      min-height:140px;
      resize:vertical;
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:10px;
      font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;
      font-size:12px;
    }
    .small{
      color:var(--muted);
      font-size:12px;
      margin-top:8px;
    }

    /* Toast */
    .toast{
      position:fixed;
      right:16px;
      bottom:16px;
      background:rgba(29,35,39,.94);
      color:#fff;
      padding:10px 12px;
      border-radius:10px;
      box-shadow:0 8px 22px rgba(0,0,0,.25);
      font-size:13px;
      transform:translateY(12px);
      opacity:0;
      pointer-events:none;
      transition:opacity .2s ease, transform .2s ease;
    }
    .toast.show{ opacity:1; transform:translateY(0); }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="inner">
      <div class="field">
        <label for="menuSelect">Vybrat menu</label>
        <select id="menuSelect"></select>
      </div>

      <button class="btn" id="newMenuBtn" title="Vytvořit nové menu">Nové menu</button>
      <button class="btn" id="newItemBtn" title="Přidat položku do aktuálního menu">Nová položka</button>

      <div class="spacer"></div>

      <button class="btn primary" id="saveBtn">Uložit</button>
    </div>
  </div>

  <div class="wrap">
    <div class="notice">
      Přetáhněte položky do pořadí, které preferujete. Kliknutím na šipku vpravo otevřete detail položky.
      Víceúrovňovou strukturu řešte tlačítky <b>Povýšit</b>/<b>Ponížit</b>.
    </div>

    <div id="list" class="list"></div>

    <div class="footer">
      <div style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px;">
        <button class="btn" id="exportBtn">Export JSON</button>
        <button class="btn" id="copyBtn">Kopírovat JSON</button>
        <span class="small">Export je pouze pro náhled / integraci (žádný back‑end).</span>
      </div>
      <textarea id="exportArea" spellcheck="false" placeholder="Zde se zobrazí export menu jako JSON…"></textarea>
      <div class="small">Tip: data se ukládají do <code>localStorage</code> v prohlížeči (stejné zařízení/prohlížeč).</div>
    </div>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    // --- Simple WordPress-like Menu Builder (flat array + level), stored in localStorage ---
    const STORAGE_KEY = "menu_builder_v1";
    const $ = (s, el=document) => el.querySelector(s);

    function uid(){ return Math.random().toString(36).slice(2,10) + Date.now().toString(36).slice(2,6); }

    function toast(msg){
      const t = $("#toast");
      t.textContent = msg;
      t.classList.add("show");
      clearTimeout(toast._tm);
      toast._tm = setTimeout(()=>t.classList.remove("show"), 1600);
    }

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(raw){
          const parsed = JSON.parse(raw);
          if(parsed && parsed.menus && Array.isArray(parsed.menus)) return parsed;
        }
      }catch(e){}
      // default
      return {
        activeMenuId: "default",
        menus: [
          {
            id:"default",
            name:"My First Menu",
            items:[
              {id:uid(), title:"Main Page", url:"/", level:0, open:false},
              {id:uid(), title:"About", url:"/about", level:0, open:true},
              {id:uid(), title:"Contact", url:"/contact", level:0, open:false},
              {id:uid(), title:"Parent Page", url:"/parent", level:0, open:false},
              {id:uid(), title:"Sub Page 1", url:"/parent/sub1", level:1, open:false},
              {id:uid(), title:"Sub Page 2", url:"/parent/sub2", level:1, open:false}
            ]
          }
        ]
      };
    }

    let state = loadState();

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    function getActiveMenu(){
      return state.menus.find(m => m.id === state.activeMenuId) || state.menus[0];
    }

    function setActiveMenu(id){
      state.activeMenuId = id;
      saveState();
      render();
    }

    // --- Flat array helpers (block = item + its descendants) ---
    function blockEnd(items, startIdx){
      const base = items[startIdx].level;
      let end = startIdx;
      for(let i=startIdx+1;i<items.length;i++){
        if(items[i].level <= base) break;
        end = i;
      }
      return end;
    }

    function extractBlock(items, startIdx){
      const end = blockEnd(items, startIdx);
      return items.splice(startIdx, end - startIdx + 1);
    }

    function insertBlock(items, idx, block){
      items.splice(idx, 0, ...block);
    }

    function findPrevSibling(items, idx){
      const lvl = items[idx].level;
      for(let i=idx-1;i>=0;i--){
        if(items[i].level === lvl) return i;
        if(items[i].level < lvl) break;
      }
      return -1;
    }

    function findNextSibling(items, idx){
      const lvl = items[idx].level;
      const end = blockEnd(items, idx);
      for(let i=end+1;i<items.length;i++){
        if(items[i].level === lvl) return i;
        if(items[i].level < lvl) break;
      }
      return -1;
    }

    function siblingsFirstIndex(items, idx){
      const lvl = items[idx].level;
      if(lvl === 0) return 0;

      let parentIdx = -1;
      for(let i=idx-1;i>=0;i--){
        if(items[i].level === lvl-1){ parentIdx = i; break; }
      }
      if(parentIdx < 0) return 0;

      for(let i=parentIdx+1;i<items.length;i++){
        if(items[i].level < lvl) break;
        if(items[i].level === lvl) return i;
      }
      return idx;
    }

    function moveUp(items, idx){
      const prev = findPrevSibling(items, idx);
      if(prev < 0) return;
      const block = extractBlock(items, idx);
      insertBlock(items, prev, block);
    }

    function moveDown(items, idx){
      const next = findNextSibling(items, idx);
      if(next < 0) return;
      const block = extractBlock(items, idx);
      const nextEnd = blockEnd(items, next);
      insertBlock(items, nextEnd + 1, block);
    }

    function moveTop(items, idx){
      const first = siblingsFirstIndex(items, idx);
      if(first === idx) return;
      const block = extractBlock(items, idx);
      insertBlock(items, first, block);
    }

    function promote(items, idx){
      if(items[idx].level === 0) return;
      const end = blockEnd(items, idx);
      for(let i=idx;i<=end;i++) items[i].level -= 1;
    }

    function demote(items, idx){
      if(idx === 0) return;
      const curLvl = items[idx].level;
      const desired = items[idx-1].level + 1;
      if(desired <= curLvl) return;
      const delta = desired - curLvl;
      const end = blockEnd(items, idx);
      for(let i=idx;i<=end;i++) items[i].level += delta;
    }

    // --- Rendering ---
    function renderMenuSelect(){
      const sel = $("#menuSelect");
      sel.innerHTML = "";
      state.menus.forEach(m=>{
        const opt = document.createElement("option");
        opt.value = m.id;
        opt.textContent = m.name;
        sel.appendChild(opt);
      });
      sel.value = getActiveMenu().id;
      sel.onchange = () => setActiveMenu(sel.value);
    }

    function arrowIcon(){
      return `
        <svg viewBox="0 0 20 20" fill="none" aria-hidden="true">
          <path d="M5 7.5L10 12.5L15 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
        </svg>`;
    }

    function escapeHtml(str){
      return String(str ?? "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function escapeAttr(str){ return escapeHtml(str).replaceAll("\\n"," "); }

    function renderList(){
      const menu = getActiveMenu();
      const list = $("#list");
      list.innerHTML = "";

      const hint = document.createElement("div");
      hint.className = "drop-hint";
      list.appendChild(hint);

      menu.items.forEach((item, idx)=>{
        const card = document.createElement("div");
        card.className = "menu-item" + (item.open ? " open" : "");
        card.draggable = true;
        card.dataset.index = String(idx);

        const head = document.createElement("div");
        head.className = "head indent";
        head.style.setProperty("--lvl", item.level);

        const title = document.createElement("div");
        title.className = "title";
        title.innerHTML = `<span class="txt">${escapeHtml(item.title || "(bez názvu)")}</span>
                           <span class="badge">Custom Link</span>`;

        const toggle = document.createElement("button");
        toggle.className = "toggle";
        toggle.type = "button";
        toggle.title = "Otevřít / zavřít detail";
        toggle.innerHTML = arrowIcon();
        toggle.addEventListener("click", (e)=>{
          e.stopPropagation();
          item.open = !item.open;
          saveState();
          renderList();
        });

        head.appendChild(title);
        head.appendChild(toggle);
        card.appendChild(head);

        const details = document.createElement("div");
        details.className = "details indent details-pad";
        details.style.setProperty("--lvl", item.level);

        details.innerHTML = `
          <div class="grid">
            <div>
              <label style="display:block;font-size:12px;color:var(--muted);margin-bottom:4px;">Název položky</label>
              <input type="text" data-field="title" value="${escapeAttr(item.title)}" placeholder="Např. O nás" />
            </div>
            <div>
              <label style="display:block;font-size:12px;color:var(--muted);margin-bottom:4px;">URL</label>
              <input type="url" data-field="url" value="${escapeAttr(item.url)}" placeholder="Např. https://example.com/about" />
            </div>
            <div class="full actions">
              <div class="links">
                <button class="linkbtn" data-act="up">Nahoru</button>
                <button class="linkbtn" data-act="down">Dolů</button>
                <button class="linkbtn" data-act="promote">Povýšit</button>
                <button class="linkbtn" data-act="demote">Ponížit</button>
                <button class="linkbtn" data-act="top">Na začátek úrovně</button>
              </div>
              <div class="spacer"></div>
              <button class="btn danger" data-act="remove" type="button">Odebrat</button>
            </div>
          </div>
          <div class="meta">Úroveň: <b>${item.level}</b> &nbsp;•&nbsp; ID: <code>${item.id}</code></div>
        `;

        details.addEventListener("input", (e)=>{
          const t = e.target;
          if(!(t instanceof HTMLInputElement)) return;
          const field = t.dataset.field;
          if(!field) return;
          if(field === "title") item.title = t.value;
          if(field === "url") item.url = t.value;
          saveState();
          const headTxt = card.querySelector(".title .txt");
          if(headTxt && field === "title") headTxt.textContent = item.title || "(bez názvu)";
        });

        details.addEventListener("click", (e)=>{
          const btn = e.target.closest("[data-act]");
          if(!btn) return;
          const act = btn.dataset.act;
          const menu = getActiveMenu();
          const idxNow = menu.items.findIndex(x=>x.id===item.id);
          if(idxNow < 0) return;

          if(act === "up") moveUp(menu.items, idxNow);
          if(act === "down") moveDown(menu.items, idxNow);
          if(act === "top") moveTop(menu.items, idxNow);
          if(act === "promote") promote(menu.items, idxNow);
          if(act === "demote") demote(menu.items, idxNow);
          if(act === "remove"){
            if(confirm(`Odebrat položku "${item.title || "(bez názvu)"}" včetně podřízených?`)){
              const end = blockEnd(menu.items, idxNow);
              menu.items.splice(idxNow, end-idxNow+1);
            } else return;
          }
          saveState();
          renderList();
        });

        card.appendChild(details);

        // Drag & Drop (reorder blocks)
        card.addEventListener("dragstart", (e)=>{
          card.classList.add("dragging");
          e.dataTransfer.effectAllowed = "move";
          e.dataTransfer.setData("text/plain", item.id);
        });
        card.addEventListener("dragend", ()=>{
          card.classList.remove("dragging");
          hint.classList.remove("show");
        });

        card.addEventListener("dragover", (e)=>{
          e.preventDefault();
          e.dataTransfer.dropEffect = "move";
          const rect = card.getBoundingClientRect();
          const before = e.clientY < rect.top + rect.height/2;
          hint.classList.add("show");
          hint.style.marginLeft = getComputedStyle(head).paddingLeft;
          hint.dataset.dropBefore = before ? "1" : "0";
          hint.dataset.targetId = item.id;

          if(before) card.before(hint);
          else card.after(hint);
        });

        card.addEventListener("drop", (e)=>{
          e.preventDefault();
          const draggedId = e.dataTransfer.getData("text/plain");
          const targetId = item.id;
          if(!draggedId || draggedId === targetId) return;

          const menu = getActiveMenu();
          const items = menu.items;
          const from = items.findIndex(x=>x.id===draggedId);
          let to = items.findIndex(x=>x.id===targetId);
          if(from < 0 || to < 0) return;

          const before = hint.dataset.dropBefore === "1";
          const block = extractBlock(items, from);

          if(from < to) to -= block.length;

          if(before){
            insertBlock(items, to, block);
          }else{
            const targetEnd = blockEnd(items, to);
            insertBlock(items, targetEnd + 1, block);
          }

          saveState();
          renderList();
        });

        list.appendChild(card);
      });

      if(menu.items.length === 0){
        const empty = document.createElement("div");
        empty.style.padding = "14px";
        empty.style.color = "var(--muted)";
        empty.textContent = "Menu je prázdné. Klikněte na „Nová položka“.";
        list.appendChild(empty);
      }
    }

    function render(){
      renderMenuSelect();
      renderList();
      $("#exportArea").value = "";
    }

    // Topbar actions
    $("#newItemBtn").addEventListener("click", ()=>{
      const menu = getActiveMenu();
      menu.items.push({id:uid(), title:"Nová položka", url:"", level:0, open:true});
      saveState();
      renderList();
      toast("Položka přidána");
    });

    $("#newMenuBtn").addEventListener("click", ()=>{
      const name = prompt("Název nového menu:", "Nové menu");
      if(!name) return;
      const id = uid();
      state.menus.push({id, name, items:[]});
      state.activeMenuId = id;
      saveState();
      render();
      toast("Menu vytvořeno");
    });

    $("#saveBtn").addEventListener("click", ()=>{
      saveState();
      toast("Uloženo do localStorage");
    });

    $("#exportBtn").addEventListener("click", ()=>{
      const menu = getActiveMenu();
      const exportObj = {
        menu: { id: menu.id, name: menu.name },
        items: menu.items.map(it=>({ title: it.title, url: it.url, level: it.level }))
      };
      $("#exportArea").value = JSON.stringify(exportObj, null, 2);
      toast("Export hotový");
    });

    $("#copyBtn").addEventListener("click", async ()=>{
      const ta = $("#exportArea");
      if(!ta.value.trim()) $("#exportBtn").click();
      try{
        await navigator.clipboard.writeText(ta.value);
        toast("Zkopírováno");
      }catch(e){
        ta.focus(); ta.select();
        document.execCommand("copy");
        toast("Zkopírováno");
      }
    });

    // init
    saveState();
    render();
  </script>
</body>
</html>
